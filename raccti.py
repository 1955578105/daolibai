import control 
import numpy as np


# 1. 定义物理常数
g = 9.81  # 重力加速度
M = 0.5   # 小车质量
m = 0.5   # 小球质量
l = 0.3   # 连杆长度

# 2. 定义矩阵 A (4x4)
# 注意：numpy 数组是行优先的
A = np.array([
    [0, 0, 1, 0],
    [0, 0, 0, 1],
    [0, (m * g) / M, 0, 0],
    [0, (g * (M + m)) / (l * M), 0, 0]
])

# 3. 定义矩阵 B (4x1)
# 注意：B 必须是二维数组（列向量形式），所以用双层方括号
B = np.array([
    [0],
    [0],
    [1 / M],
    [1 / (l * M)]
])

# 4. 定义权重矩阵 Q (4x4) 和 R (标量/1x1)
Q = np.array([
    [100, 0, 0, 0],
    [0, 10, 0, 0],
    [0, 0, 1, 0],
    [0, 0, 0, 1]
])
# 或者更简单的写法: Q = np.diag([100, 10, 1, 1])

R = 1  # 也可以写成 np.array([[1]])

# 5. 求解 LQR 问题 (内部会自动求解黎卡提方程)
# 函数返回三个值：
# K: 最优反馈增益矩阵 (u = -Kx)
# S: 黎卡提方程的解 (即矩阵 P)
# E: 闭环系统的特征值 (极点)
K, S, E = control.lqr(A, B, Q, R)


# print("--- 黎卡提方程的解 (矩阵 P/S) ---")
# print(S)
# print("\n--- 最优反馈增益 (矩阵 K) ---")
print(K)